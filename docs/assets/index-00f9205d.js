var I=Object.defineProperty;var X=(i,t,e)=>t in i?I(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var c=(i,t,e)=>(X(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();const h={ALL:"all",FPS:"fps",INIT:"init",RENDER_START:"renderStart",RENDER_END:"renderEnd",IMAGE_LOADED:"imageLoaded",RENDER_SPRITE:"renderSprite",ANIMATION_END:"animationEnd",ATTACK:"attack",ATTACK_COMMAND:"attackCommand"},p=class p{constructor(){c(this,"listeners",{[p.ALL]:[]});c(this,"on",(t,e)=>{this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)});c(this,"once",(t,e)=>{let a=(r,s)=>{e(r,s),this.off(r,a)};this.on(t,a)});c(this,"emit",(t,e)=>{const a=this.listeners[t];if(a){const s=a.length;for(let o=0;o<s;o++)a[o](t,e)}const r=this.listeners[p.ALL];if(r){const s=r.length;for(let o=0;o<s;o++)r[o](t,e)}});c(this,"off",(t,e)=>{const a=this.listeners[t];a&&(this.listeners[t]=a.filter(r=>r!==e))})}};c(p,"ALL",h.ALL);let D=p;const m={up:["ArrowUp","w"],down:["ArrowDown","s"],left:["ArrowLeft","a"],right:["ArrowRight","d"],attack:[" "],toggleDebugGameState:["O"],debugPlayerSpriteSheet:["P"]},P=i=>t=>{m.attack.includes(t.key)&&(t.preventDefault(),i.controls.attack=!0,i.emitter.emit(h.ATTACK_COMMAND,null)),m.up.includes(t.key)&&(t.preventDefault(),i.controls.up=!0),m.down.includes(t.key)&&(t.preventDefault(),i.controls.down=!0),m.left.includes(t.key)&&(t.preventDefault(),i.controls.left=!0),m.right.includes(t.key)&&(t.preventDefault(),i.controls.right=!0),m.toggleDebugGameState.includes(t.key)&&(t.preventDefault(),i.settings.debugGameState=!i.settings.debugGameState,i.elements.gameStateContainer.style.display=i.settings.debugGameState?"block":"none"),m.debugPlayerSpriteSheet.includes(t.key)&&(t.preventDefault(),i.settings.debugPlayerSpriteSheet=!i.settings.debugPlayerSpriteSheet)},O=i=>t=>{m.up.includes(t.key)&&(t.preventDefault(),i.controls.up=!1),m.down.includes(t.key)&&(t.preventDefault(),i.controls.down=!1),m.left.includes(t.key)&&(t.preventDefault(),i.controls.left=!1),m.right.includes(t.key)&&(t.preventDefault(),i.controls.right=!1)};const U=1,A=.25,W=.25,G=(i,t)=>{const e=new Image;return e.onload=i,e.src=t,e},_=i=>i.split(" ").reduce((a,r)=>{const[s,o]=r.split("=");return["true","false"].includes(o)?a[s]=o==="true":a[s]=o,a},{}),H=i=>Object.entries(i.frames).reduce((t,[e,a],r)=>{var n;const[s,o]=e.split("--");if(t[s])t[s].frames.push(a);else if(i.meta.frameTags){const f=((n=i.meta.frameTags.find(({name:d})=>s===d))==null?void 0:n.data)||"",l=_(f);t[s]={frames:[a],data:l}}return t},{});class M{constructor(t,e,a,r){c(this,"spriteSheet");c(this,"spriteFrames");this.spriteJSON=t,this.emitter=a,this.onLoad=r,this.spriteSheet=G(()=>{var s;(s=this.onLoad)==null||s.call(this),this.emitter.emit(h.IMAGE_LOADED,{imagePath:e})},e),this.spriteJSON=t,this.spriteFrames=H(this.spriteJSON)}}function Y(i,t){return([e,a])=>a.data.direction===t&&(!!a.data.movement==!!i.moving||i.attacking)&&!!i.attacking==!!a.data.attack}const w=i=>i.width/20,L=(i,t,e,{canvasX:a,canvasY:r,canvasWidth:s,canvasHeight:o,spriteX:n,spriteY:f,spriteWidth:l,spriteHeight:d})=>{i.imageSmoothingEnabled=!1,i.drawImage(e,n,f,l,d,a,r,s,o)},K={"Blink Bounce Down--0":{frame:{x:2,y:2,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Down--1":{frame:{x:20,y:2,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Down--2":{frame:{x:38,y:2,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Down--3":{frame:{x:56,y:2,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Down--4":{frame:{x:74,y:2,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Down--0":{frame:{x:2,y:20,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Down--1":{frame:{x:20,y:20,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Down--2":{frame:{x:38,y:20,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Down--3":{frame:{x:56,y:20,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Right--0":{frame:{x:2,y:38,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Right--1":{frame:{x:20,y:38,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Right--2":{frame:{x:38,y:38,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Right--3":{frame:{x:56,y:38,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Right--0":{frame:{x:2,y:56,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Right--1":{frame:{x:20,y:56,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Right--2":{frame:{x:38,y:56,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Right--3":{frame:{x:56,y:56,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Right--4":{frame:{x:74,y:56,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Left--0":{frame:{x:2,y:74,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Left--1":{frame:{x:20,y:74,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Left--2":{frame:{x:38,y:74,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Left--3":{frame:{x:56,y:74,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Left--4":{frame:{x:74,y:74,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Left--0":{frame:{x:2,y:92,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Left--1":{frame:{x:20,y:92,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Left--2":{frame:{x:38,y:92,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Left--3":{frame:{x:56,y:92,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Blink Bounce Left--4":{frame:{x:74,y:92,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Up--0":{frame:{x:2,y:110,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Up--1":{frame:{x:20,y:110,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Up--2":{frame:{x:38,y:110,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Bounce Up--3":{frame:{x:56,y:110,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Hair Move up--0":{frame:{x:2,y:128,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Hair Move up--1":{frame:{x:20,y:128,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Hair Move up--2":{frame:{x:38,y:128,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Hair Move up--3":{frame:{x:56,y:128,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Down--0":{frame:{x:2,y:146,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Down--1":{frame:{x:20,y:146,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Down--2":{frame:{x:38,y:146,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Down--3":{frame:{x:56,y:146,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Down--4":{frame:{x:74,y:146,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Right--0":{frame:{x:2,y:164,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Right--1":{frame:{x:20,y:164,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Right--2":{frame:{x:38,y:164,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Right--3":{frame:{x:56,y:164,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Right--4":{frame:{x:74,y:164,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Right--5":{frame:{x:92,y:164,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Right--6":{frame:{x:110,y:164,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Right--7":{frame:{x:128,y:164,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Left--0":{frame:{x:2,y:182,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Left--1":{frame:{x:20,y:182,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Left--2":{frame:{x:38,y:182,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Left--3":{frame:{x:56,y:182,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Left--4":{frame:{x:74,y:182,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Left--5":{frame:{x:92,y:182,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Left--6":{frame:{x:110,y:182,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Left--7":{frame:{x:128,y:182,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Left--8":{frame:{x:146,y:182,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Up--0":{frame:{x:2,y:200,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Up--1":{frame:{x:20,y:200,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Up--2":{frame:{x:38,y:200,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Up--3":{frame:{x:56,y:200,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Up--4":{frame:{x:74,y:200,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Walk Up--5":{frame:{x:92,y:200,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Down--0":{frame:{x:2,y:218,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Down--1":{frame:{x:20,y:218,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Down--2":{frame:{x:38,y:218,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Right--0":{frame:{x:2,y:236,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Right--1":{frame:{x:20,y:236,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Right--2":{frame:{x:38,y:236,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Left--0":{frame:{x:2,y:254,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Left--1":{frame:{x:20,y:254,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Left--2":{frame:{x:38,y:254,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Up--0":{frame:{x:2,y:272,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Up--1":{frame:{x:20,y:272,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Up--2":{frame:{x:38,y:272,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100}},q={app:"https://www.aseprite.org/",version:"1.3-rc6-x64",image:"kuesuto-player.png",format:"RGBA8888",size:{w:164,h:290},scale:"1",frameTags:[{name:"Blink Bounce Down",from:0,to:4,direction:"forward",color:"#000000ff",data:"direction=down movement=false blink=true"},{name:"Bounce Down",from:5,to:8,direction:"forward",color:"#000000ff",data:"direction=down movement=false blink=false"},{name:"Bounce Right",from:9,to:12,direction:"forward",color:"#000000ff",data:"direction=right movement=false blink=false"},{name:"Blink Bounce Right",from:13,to:17,direction:"forward",color:"#000000ff",data:"direction=right movement=false blink=true"},{name:"Bounce Left",from:18,to:22,direction:"forward",color:"#000000ff",data:"direction=left movement=false blink=false"},{name:"Blink Bounce Left",from:23,to:27,direction:"forward",color:"#000000ff",data:"direction=left movement=false blink=true"},{name:"Bounce Up",from:28,to:31,direction:"forward",color:"#000000ff",data:"direction=up movement=false blink=false"},{name:"Hair Move up",from:32,to:35,direction:"forward",color:"#000000ff",data:"direction=up movement=false blink=true"},{name:"Walk Down",from:36,to:40,direction:"forward",color:"#000000ff",data:"direction=down movement=true blink=false"},{name:"Walk Right",from:41,to:48,direction:"forward",color:"#000000ff",data:"direction=right movement=true blink=false"},{name:"Walk Left",from:49,to:57,direction:"forward",color:"#000000ff",data:"direction=left movement=true blink=false"},{name:"Walk Up",from:58,to:63,direction:"forward",color:"#000000ff",data:"direction=up movement=true blink=false"},{name:"Swing Down",from:64,to:66,direction:"forward",color:"#000000ff",data:"direction=down movement=false blink=false attack=true"},{name:"Swing Right",from:67,to:69,direction:"forward",color:"#000000ff",data:"direction=right movement=false blink=false attack=true"},{name:"Swing Left",from:70,to:72,direction:"forward",color:"#000000ff",data:"direction=left movement=false blink=false attack=true"},{name:"Swing Up",from:73,to:75,direction:"forward",color:"#000000ff",data:"direction=up movement=false blink=false attack=true"}]},J={frames:K,meta:q},$={"Swing Up--0":{frame:{x:2,y:2,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Up--1":{frame:{x:20,y:2,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Up--2":{frame:{x:38,y:2,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Right--0":{frame:{x:2,y:20,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Right--1":{frame:{x:20,y:20,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Right--2":{frame:{x:38,y:20,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Down--0":{frame:{x:2,y:38,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Down--1":{frame:{x:20,y:38,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Down--2":{frame:{x:38,y:38,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Left--0":{frame:{x:2,y:56,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Left--1":{frame:{x:20,y:56,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Swing Left--2":{frame:{x:38,y:56,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100}},j={app:"https://www.aseprite.org/",version:"1.3-rc6-x64",image:"kuesuto-sword.png",format:"RGBA8888",size:{w:56,h:74},scale:"1",frameTags:[{name:"Swing Up",from:0,to:2,direction:"forward",color:"#000000ff",data:"direction=up attack=true"},{name:"Swing Right",from:3,to:5,direction:"forward",color:"#000000ff",data:"direction=right attack=true"},{name:"Swing Down",from:6,to:8,direction:"forward",color:"#000000ff",data:"direction=down attack=true"},{name:"Swing Left",from:9,to:11,direction:"forward",color:"#000000ff",data:"direction=left attack=true"}]},Q={frames:$,meta:j};let V=0;class b{constructor(t,e,a,r){c(this,"id",V++);c(this,"sprite");this.state=t,this.name=e,this.children=a,this.emitter=r}static getDirection(t){const e=t.yDir<0,a=t.yDir>0,r=t.xDir>0,s=t.xDir<0;return e?"up":a?"down":r?"right":s?"left":"down"}getDirection(){return b.getDirection(this.state)}update(t,e,a){var r;if((r=this.children)!=null&&r.length)for(let s=0;s<this.children.length;s++)this.children[s].update(t,e,this)}}class v extends b{constructor(t,e,a,r,s,o){super(t,e,a,r),this.state=t,this.name=e,this.children=a,this.emitter=r,this.sprite=new M(s,o,r)}}const z=class z extends v{constructor(e,a,r){super(e,z.NAME,a,r,J,"./kuesuto-player.png");c(this,"update",(e,a,r)=>{super.update(e,a,r);let s=!1,o=this.state.yDir,n=this.state.xDir,f=!1,l=!1;if(e.controls.up&&(o=-1,s=!0,l=!0),e.controls.down&&(o=1,s=!0,l=!0),e.controls.left&&(n=-1,s=!0,f=!0),e.controls.right&&(n=1,s=!0,f=!0),s){const d=Math.atan2(o,n);this.state.x+=Math.cos(d)*this.state.speedX*e.time.delta,this.state.y+=Math.sin(d)*this.state.speedY*e.time.delta}this.state.moving=s,f&&!l?o=0:l&&!f&&(n=0),this.state.yDir=o,this.state.xDir=n,this.state.attacking=e.controls.attack});this.state=e,this.children=a}};c(z,"NAME","player");let x=z;class Z extends v{constructor(t,e,a,r,s,o){super(t,e,a,r,s,o),this.state=t,this.name=e,this.children=a}}const g=class g extends Z{constructor(e,a,r){super(e,g.NAME,a,r,Q,"./kuesuto-sword.png");c(this,"attackListener",null);c(this,"update",(e,a,r)=>{if(super.update(e,a,r),r)switch(this.state.xDir=r.state.xDir,this.state.yDir=r.state.yDir,r.getDirection()){case"up":{this.state.x=r.state.x,this.state.y=r.state.y-w(e.elements.mainCanvas)*r.state.scaleY;break}case"down":{this.state.x=r.state.x,this.state.y=r.state.y+w(e.elements.mainCanvas)*r.state.scaleY;break}case"right":{this.state.x=r.state.x+w(e.elements.mainCanvas)*r.state.scaleX,this.state.y=r.state.y;break}case"left":{this.state.x=r.state.x-w(e.elements.mainCanvas)*r.state.scaleX,this.state.y=r.state.y;break}}if(!this.attackListener){const s=(o,n)=>{n.entity===this&&(e.controls.attack=!1,this.state.attacking=!1,this.state.visible=!1)};this.emitter.on(h.ANIMATION_END,s),this.attackListener=s}e.controls.attack&&!this.state.attacking&&(this.state.attacking=!0,this.state.visible=!0)});this.state=e,this.children=a,this.emitter=r}};c(g,"NAME","sword");let B=g;const ee=(i,t,e)=>{i.beginPath(),i.fillStyle=e,i.rect(0,0,t.width,t.height),i.fill(),i.closePath()},te=(i,t,e)=>{var n;if(!e.sprite)throw new Error("No sprite on entity");const a=e.state;let r;r=Object.entries((n=e.sprite)==null?void 0:n.spriteFrames).filter(Y(a,t));const[s,o]=r.find(([f,l])=>{var y;if(!f)throw new Error("Failed to load sprite sheet");let d=null;if(a.currentAnimationName===f&&a.animationToEnd&&a.animationFrameX===0&&(a.lastAnimationName=f,i.emitter.emit(h.ANIMATION_END,{entity:e,name:f}),a.animationToEnd=!1,d=!1),a.lastAnimationName===f&&r.length>1&&(d=!1),a.animationFrameX>=l.frames.length-1&&(a.animationToEnd=!0),d!==!1&&(d=!0),d){const k=i.time.lastFrameTimeMs-a.animationFrameXStart;a.animationFrameX>=l.frames.length&&(a.animationFrameX=0),k>((y=l.frames[a.animationFrameX])==null?void 0:y.duration)*U&&(a.animationFrameXStart=i.time.lastFrameTimeMs,a.animationFrameX++,a.animationFrameX>=l.frames.length&&(a.animationFrameX=0))}return d})||r[0];if(s==="")throw new Error("Sprite frame name not found");if(!o)throw new Error("Sprite frame value not found");return a.currentAnimationName=s,o.frames[a.animationFrameX]},T=(i,t,e,a)=>{if(!i.sprite||!i.state.visible)return;const r=i.state,s=i.getDirection(),o=te(a,s,i),n=o.spriteSourceSize.w,f=o.spriteSourceSize.h,l=o.frame.x,d=o.frame.y,y=r.x,k=r.y,F={canvasX:y,canvasY:k,canvasWidth:w(e)*r.scaleX,canvasHeight:w(e)*r.scaleY,spriteX:l,spriteY:d,spriteWidth:n,spriteHeight:f};a.emitter.emit(h.RENDER_SPRITE,{spriteData:F,entity:i});const S=i.sprite.spriteSheet;if(L(t,e,S,F),a.settings.debugPlayerSpriteSheet&&i.name===x.NAME){L(t,e,S,{canvasX:250,canvasY:250,canvasWidth:S.naturalWidth*4,canvasHeight:S.naturalHeight*4,spriteX:0,spriteY:0,spriteWidth:S.naturalWidth,spriteHeight:S.naturalHeight}),t.beginPath(),t.strokeStyle="teal";const C=t.lineWidth;t.lineWidth=5,t.rect(250+l*4,250+d*4,n*4,f*4),t.stroke(),t.lineWidth=C,t.closePath()}},re=(i,t,e)=>{var s,o;e.emitter.emit(h.RENDER_START,null),ee(i,t,"#fff"),e.map.draw(i,t,e);const a=e.entities,r=a.length;for(let n=0;n<r;n++){T(a[n],i,t,e);for(let f=0;f<(((o=(s=a[n])==null?void 0:s.children)==null?void 0:o.length)||0);f++)T(a[n].children[f],i,t,e)}e.settings.debugGameState&&e.elements.gameStateContainer&&(e.elements.gameStateContainer.innerHTML=JSON.stringify({controls:e.controls,emitter:e.emitter,entities:e.entities.map(n=>({id:n.id,name:n.name,state:n.state})),settings:e.settings,time:e.time,world:e.world},null,2)),e.emitter.emit(h.RENDER_END,null)},ie=(i,t)=>{const e=i.entities,a=e.length;for(let r=0;r<a;r++)e[r].update(i,t)},ae=i=>{i.time.resetDeltaCount++,i.time.delta=0},se=(i,t,e)=>{if(!i)throw new Error("Missing canvas context");const a=r=>{if(r<e.time.lastFrameTimeMs+1e3/e.time.maxFPS){e.time.stepID=window.requestAnimationFrame(a);return}if(e.world.running){e.time.delta+=r-e.time.lastFrameTimeMs,e.time.lastFrameTimeMs=r,r>e.time.lastFpsUpdate+1e3&&(e.time.fps=.25*e.time.framesThisSecond+.75*e.time.fps,e.time.lastFpsUpdate=r,e.time.framesThisSecond=0,e.emitter.emit(h.FPS,{fps:e.time.fps})),e.time.framesThisSecond++;let s=0;for(;e.time.delta>=e.time.timeStep;)if(ie(e,r),e.time.delta-=e.time.timeStep,++s>=240){ae(e);break}}e.time.frameID++,re(i,t,e),e.time.stepID=window.requestAnimationFrame(a)};a(1)},oe={"Tall Grass":{frame:{x:2,y:2,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Tall Grass and Flowers":{frame:{x:2,y:20,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},Grass:{frame:{x:2,y:38,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Grass Path Left":{frame:{x:2,y:56,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100},"Gras Path Right":{frame:{x:2,y:74,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16},duration:100}},ne={app:"https://www.aseprite.org/",version:"1.3-rc6-x64",image:"kuesuto-tiles.png",format:"RGBA8888",size:{w:20,h:92},scale:"1",frameTags:[],layers:[{name:"Tall Grass",opacity:255,blendMode:"normal"},{name:"Tall Grass and Flowers",opacity:255,blendMode:"normal"},{name:"Grass",opacity:255,blendMode:"normal"},{name:"Grass Path Left",opacity:255,blendMode:"normal"},{name:"Gras Path Right",opacity:255,blendMode:"normal"}]},N={frames:oe,meta:ne};class fe{constructor(t,e){c(this,"tiles");c(this,"draw",(t,e,a)=>{const r=e.width,s=e.height,o=w(e),n=N.frames.Grass;for(let f=0;f<=r;f+=o*.9)for(let l=0;l<=s;l+=o*.9)L(t,e,this.tiles.spriteSheet,{spriteX:n.frame.x,spriteY:n.frame.y,spriteWidth:n.frame.w,spriteHeight:n.frame.h,canvasX:f,canvasY:l,canvasWidth:w(e)*this.state.scaleX,canvasHeight:w(e)*this.state.scaleY})});this.state=t,this.emitter=e,this.tiles=new M(N,"./kuesuto-tiles.png",e)}}let E,R,u;const le=()=>{const i=new D,t=document.querySelector("#main-game-canvas");if(!t)throw new Error("Main canvas not found");t.width=window.innerWidth,t.height=window.innerHeight;const e=t==null?void 0:t.getContext("2d");if(!e)throw new Error("Main canvas context not found");i.emit(h.INIT,{mainCanvas:t,mainCanvasContext:e});const a=document.querySelector("#game-state");if(!a)throw new Error("Game State Container not found");const r=document.querySelector("#main-game-fps");if(!r)throw new Error("Main Game Fps Container not found");const s={entities:[new x({x:0,y:0,xDir:0,yDir:0,speedX:A,speedY:W,scaleX:1,scaleY:1,visible:!0,moving:!1,attacking:!1,currentAnimationName:"",lastAnimationName:"",animationToEnd:!1,animationFrameX:0,animationFrameXStart:0},[new B({x:0,y:0,xDir:0,yDir:0,speedX:A,speedY:W,scaleX:1,scaleY:1,visible:!1,moving:!1,attacking:!1,currentAnimationName:"",lastAnimationName:"",animationToEnd:!1,animationFrameX:0,animationFrameXStart:0},[],i)],i)],map:new fe({scaleX:1,scaleY:1},i),controls:{up:!1,down:!1,left:!1,right:!1,attack:!1},world:{running:!1,started:!1},settings:{debugGameState:!1,debugPlayerSpriteSheet:!1,showFps:!0},time:{delta:0,fps:60,framesThisSecond:0,lastFpsUpdate:0,lastFrameTimeMs:0,maxFPS:60,timeStep:1e3/60,stepID:0,frameID:0,resetDeltaCount:0},elements:{mainCanvas:t,mainCanvasContext:e,gameStateContainer:a,mainGameFpsContainer:r},emitter:i};return i.on(h.FPS,(o,n)=>{console.log(n),s.settings.showFps&&(n!=null&&n.fps)&&(s.elements.mainGameFpsContainer.innerHTML=Math.round(n.fps).toString())}),e==null||e.rect(0,0,t.width,t.height),e==null||e.fill(),{mainCanvas:t,mainCanvasContext:e,gameState:s}};try{const i=le();E=i.mainCanvas,R=i.mainCanvasContext,u=i.gameState}catch(i){console.error("Failed to initialize"+i)}document.addEventListener("keydown",i=>{P(u)(i)});document.addEventListener("keyup",i=>{O(u)(i)});window.addEventListener("resize",()=>{u.elements.mainCanvas.width=window.innerWidth,u.elements.mainCanvas.height=window.innerHeight});document.addEventListener("visibilitychange",()=>{u.world.running=document.visibilityState==="visible",console.log({running:u.world.running})});const de=()=>{R&&E&&u&&(u.world.started=!0,u.world.running=!0,se(R,E,u))};de();
